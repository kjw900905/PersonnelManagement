<!--?xml version="1.0" encoding="UTF-8"? -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="commonCode">


	<insert id="commonInsert" parameterType="HashMap" >
	
		/* /main/commonMapper.xml - commonInsert(공통코드 등록) */
		
		INSERT INTO COMMON
		(
		COMM_CODE,
		COMM_PRNT_CODE,
		COMM_NAME,
		COMM_CODE_INFO,
		DEPT_CODE,
		DEPT_UPDT_CODE,
		COMM_CODE_CRT,
		COMM_CODE_UPDT,
		COMM_DEL_YN
		)
		VALUES
		(
		#{commCode},
		#{commPrntCode},
		#{commName},
		#{commCodeInfo},
		#{deptCode},
		#{deptUpdtCode},
		#{commCodeCrt},
		#{commCodeUpdt},
		#{commDelYn}
		);
		
	</insert>
	
	
	<select id="commCodeCheck" parameterType="Integer" resultType="HashMap">
	
		SELECT
			COMM_CODE AS commCode
		FROM COMMON
		WHERE COMM_CODE = #{commCode}			
	
	</select>
	
	
	<select id="commonList" parameterType="HashMap" resultType="HashMap">
		
		/* /main/commonMapper.xml - commonSelect(공통코드 목록) */
		
		SELECT
			C.COMM_CODE AS commCode,
			C.COMM_PRNT_CODE AS commPrntCode,
			C.COMM_NAME AS commName,
			C.DEPT_CODE AS deptCode,
			C.DEPT_UPDT_CODE AS deptUpdtCode,
			C.COMM_CODE_INFO AS commCodeInfo,
			DATE_FORMAT(C.COMM_CODE_CRT, "%Y-%m-%d") AS commCodeCrt,
			C.COMM_CODE_UPDT AS commCodeUpdt,
			C.COMM_DEL_YN AS commDelYn
		FROM 
		(
			SELECT
				*
			FROM COMMON
			WHERE COMM_PRNT_CODE = '' AND COMM_DEL_YN = 'N'
			<if test="commonSearch != null">
				<choose>
					<when test="commonSelect == 'commCode'">
						AND COMM_CODE LIKE '%' + '#{commonSearch}' + '%'
					</when>
					<when test="commonSelect == 'commName'">
						AND COMM_NAME LIKE '%' + '#{commonSearch}' + '%'
					</when>
					<when test="commonSelect == 'commCodeInfo'">
						AND COMM_CODE_INFO LIKE '%' + '#{commonSearch}' + '%'
					</when>
					<otherwise>
						AND DEPT_CODE LIKE '%' + '#{commonSearch}' + '%'
					</otherwise>
				</choose>
			</if>
		)C
		ORDER BY C.COMM_CODE DESC
		LIMIT #{startPost},#{postNum};
	
	</select>
	
	
	
	<update id="commonUpdate" parameterType="HashMap">
	
		/* /main/commonMapper.xml - commonUpdate(공통코드, 공통코드 상세 수정) */
		UPDATE COMMON
		SET COMM_NAME = #{commName},
			COMM_CODE_INFO = #{commCodeInfo}, 
			COMM_CODE_UPDT = #{commCodeUpdt},
			DEPT_UPDT_CODE = #{deptUpdtCode}
		WHERE COMM_CODE = #{commCode}
	
	</update>
	
	
	<select id="commonDeleteCheck" parameterType="Integer" resultType="HashMap">
	
		/* /main/commonMapper.xml - commonDeleteCheck(공통 부모코드 삭제 전 하위코드 존재 유무 확인) */
		SELECT
			COMM_CODE
		FROM COMMON
		WHERE COMM_PRNT_CODE = #{commCode} AND COMM_DEL_YN = 'N'
	
	</select>
	
	
	<update id="commonDelete" parameterType="Integer">
	
		/* /main/commonMapper.xml - commonDelete(공통코드, 공통코드 상세 삭제) */
		UPDATE COMMON
		SET
			COMM_DEL_YN = 'Y'
		WHERE COMM_CODE = #{commCode}
	
	</update>
	
	
	<insert id="commonInfoInsert" parameterType="HashMap">
	
		/* /main/commonMapper.xml = commonInfoInsert(공통코드 상세 등록) */
		INSERT INTO COMMON 
		(
		COMM_CODE
		, COMM_PRNT_CODE
		, COMM_NAME
		, COMM_CODE_INFO
		, DEPT_CODE
		, DEPT_UPDT_CODE
		, COMM_CODE_CRT
		, COMM_CODE_UPDT
		, COMM_DEL_YN
		)
		VALUES
		(
		#{commCode}
		, #{commPrntCode}
		, #{commName}
		, #{commCodeInfo}
		, #{deptCode}
		, #{deptUpdtCode}
		, #{commCodeCrt}
		, #{commCodeUpdt}
		, #{commDelYn}
		)
	
	</insert>
	
	
	<select id="commonInfoList" parameterType="Integer" resultType="HashMap">

		/* /main/commonMapper.xml - commonInfoSelect(공통코드 상세목록)*/
		SELECT
			COMM_CODE AS commCode,
			COMM_PRNT_CODE AS commPrntCode,
			COMM_NAME AS commName,
			COMM_CODE_INFO AS commCodeInfo,
			DEPT_CODE AS deptCode,
			DEPT_UPDT_CODE AS deptUpdtCode,
			DATE_FORMAT(COMM_CODE_CRT, "%Y-%m-%d") AS commCodeCrt,
			DATE_FORMAT(COMM_CODE_UPDT, "%Y-%m-%d") AS commCodeUpdt
		FROM
			COMMON
		WHERE COMM_PRNT_CODE = #{commPrntCode} AND COMM_DEL_YN = 'N'

	</select>
	
	
	
	<select id="commAllPostNum" parameterType="HashMap" resultType="Integer">
	
		/* /main/commonMapper.xml - pagingAllPostNum(페이징 전체 게시물 개수) */
		SELECT
			COUNT(COMM_CODE) AS allPostNum
		FROM
			COMMON
		WHERE COMM_DEL_YN = 'N'
	
	</select>
	
	
</mapper>